<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8" />
    <title>Explosion Guy</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            background: #1a1a1a;
        }
    </style>
</head>
<body>
<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 544, //17 x 32
        height: 416, //13 x 32
        autoCenter: true,
        // Bildschirm ausfüllen
        scale: {
            mode: Phaser.Scale.FIT
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        },
        physics: {
            default:"arcade", arcade:{
                debug:true
            }
        }
    };

    var game = new Phaser.Game(config);

    // Hier werden die Assets vor dem eigentlichen Spiel geladen
    function preload ()
    {
        this.load.image("tiles", "assets/tilemaps/tileBild.png");
        this.load.image("explosionGuy", "assets/explosionGuyHell.png")
        //Daten aus erstellter JSON Tilemap beziehen
        this.load.tilemapTiledJSON("map","assets/tilemaps/explosionGuy.tmj");
    }

    function create ()
    {
        // Map JSON von von Tiled laden
        const map = this.make.tilemap({key: "map", tileWidth:32, tileHeight:32});
        const tileset = map.addTilesetImage("tileBild", "tiles");

        // Layer die Keys übergeben, die in Tiled bestimmt wurden
        const hintergrundLayer = map.createLayer("hintergrund", tileset, 0, 0);
        const interaktivLayer = map.createLayer("interaktiv", tileset, 0, 0);
        // Kollisions-Eigenschaft aus Layer beziehen
        hintergrundLayer.setCollisionByProperty({collide:true});
        interaktivLayer.setCollisionByProperty({collide:true});
        //Spieler mit Kollisionserkennung ausstatten
        //this.physics.add.collider(this.player, hintergrundLayer); //TODO Hier macht er Schwierigkeiten
        //this.physics.add.collider(this.player, interaktivLayer);
        // Spieler erstellen
        this.player = this.physics.add.sprite(100,100, "explosionGuy");

        // Spieler in Ecke links oben platzieren als Startposition
        this.player.setPosition(48, 48)
        this.cursors = this.input.keyboard.createCursorKeys();
    }

    function update ()
    {
        this.player.setVelocity(0, 0);

        if(this.cursors.up.isDown)
        {
            this.player.setVelocityY(-100);
        }
        else if(this.cursors.down.isDown)
        {
            this.player.setVelocityY(100);
        }
        else if(this.cursors.right.isDown)
        {
            this.player.setVelocityX(100);
        }
        else if(this.cursors.left.isDown)
        {
            this.player.setVelocityX(-100);
        }
    }
</script>

</body>
</html>